/* [create-plugin] version: 5.15.1 */
define(["@grafana/data","@grafana/runtime","@grafana/ui","module","react"],((e,t,r,n,o)=>(()=>{"use strict";var a={781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=r},308:e=>{e.exports=n},959:e=>{e.exports=o}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return a[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="public/plugins/maxmarkusprogram-prtg-datasource/";var c={};l.r(c),l.d(c,{plugin:()=>W});var s=l(308),u=l.n(s);l.p=u()&&u().uri?u().uri.slice(0,u().uri.lastIndexOf("/")+1):"public/plugins/maxmarkusprogram-prtg-datasource/";var p=l(781),d=l(531);function f(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function y(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){f(a,n,o,i,l,"next",e)}function l(e){f(a,n,o,i,l,"throw",e)}i(void 0)}))}}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class v extends d.DataSourceWithBackend{applyTemplateVariables(e,t){return h(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){b(e,t,r[t])}))}return e}({},e),{channel:(0,d.getTemplateSrv)().replace(e.channel,t)})}filterQuery(e){return!!e.channel}getGroups(){var e=this;return y((function*(){return e.getResource("groups")}))()}getDevices(){var e=this;return y((function*(){return e.getResource("devices")}))()}getSensors(){var e=this;return y((function*(){return e.getResource("sensors")}))()}getChannels(e){var t=this;return y((function*(){if(!e)throw new Error("objid is required");return t.getResource(`channels/${e}`)}))()}constructor(e){super(e),b(this,"annotations",void 0)}}var g=l(959),m=l.n(g),O=l(7);function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){S(e,t,r[t])}))}return e}function E(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var j=function(e){return e.Metrics="metrics",e.Raw="raw",e.Text="text",e}({});const P=Object.keys(j).map((e=>({label:e,value:j[e]}))),D=[{name:"active",visible_name:"Active"},{name:"message_raw",visible_name:"Message"},{name:"priority",visible_name:"Priority"},{name:"status",visible_name:"Status"},{name:"tags",visible_name:"Tags"}],I=[{name:"group",visible_name:"Group"},{name:"device",visible_name:"Device"},{name:"sensor",visible_name:"Sensor"}];function C(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){C(a,n,o,i,l,"next",e)}function l(e){C(a,n,o,i,l,"throw",e)}i(void 0)}))}}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){F(e,t,r[t])}))}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const W=new p.DataSourcePlugin(v).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e,{jsonData:n,secureJsonFields:o,secureJsonData:a}=r;return m().createElement(m().Fragment,null,m().createElement(O.InlineField,{label:"Path",labelWidth:14,interactive:!0,tooltip:"Json field returned to frontend"},m().createElement(O.Input,{id:"config-editor-path",onChange:e=>{t(E(w({},r),{jsonData:E(w({},n),{path:e.target.value})}))},value:n.path,placeholder:"Enter the path, <your.prtg.server> without https://",width:60})),m().createElement(O.InlineField,{label:"API Key",labelWidth:14,interactive:!0,tooltip:"Secure json field (backend only)"},m().createElement(O.SecretInput,{required:!0,id:"config-editor-api-key",isConfigured:o.apiKey,value:null==a?void 0:a.apiKey,placeholder:"Enter your API key",width:60,onReset:()=>{t(E(w({},r),{secureJsonFields:E(w({},r.secureJsonFields),{apiKey:!1}),secureJsonData:E(w({},r.secureJsonData),{apiKey:""})}))},onChange:e=>{t(E(w({},r),{secureJsonData:{apiKey:e.target.value}}))}})),m().createElement(O.InlineField,{label:"Cache Time",labelWidth:14,interactive:!0,tooltip:"Cache time in seconds"},m().createElement(O.Input,{id:"config-editor-cache-time",onChange:e=>{t(E(w({},r),{jsonData:E(w({},n),{cacheTime:parseInt(e.target.value,10)})}))},value:n.cacheTime,placeholder:"Enter the cache time",width:60})))})).setQueryEditor((function({query:e,onChange:t,onRunQuery:r,datasource:n}){const o=e.queryType===j.Metrics,a=e.queryType===j.Raw,i=e.queryType===j.Text,[l,c]=(0,g.useState)(""),[s,u]=(0,g.useState)(""),[p,d]=(0,g.useState)(""),[f,y]=(0,g.useState)(""),[b,h]=(0,g.useState)(""),[v,S]=(0,g.useState)({groups:[],devices:[],sensors:[],channels:[],values:[],properties:[],filterProperties:[]}),[w,E]=(0,g.useState)(!1);(0,g.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getGroups();if(e&&Array.isArray(e.groups)){const t=e.groups.map((e=>({label:e.group,value:e.group.toString()})));S((e=>x(T({},e),{groups:t})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching groups:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]),(0,g.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getDevices();if(e&&Array.isArray(e.devices)){const t=l?e.devices.filter((e=>e.group===l)):e.devices,r=t.map((e=>({label:e.device,value:e.device.toString()})));S((e=>x(T({},e),{devices:r})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching devices:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,l]),(0,g.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getSensors();if(e&&Array.isArray(e.sensors)){const t=s?e.sensors.filter((e=>e.device===s)):e.sensors,r=t.map((e=>({label:e.sensor,value:e.sensor.toString()})));S((e=>x(T({},e),{sensors:r})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching sensors:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,s]),(0,g.useEffect)((()=>{function e(){return(e=k((function*(){if(b){E(!0);try{const e=yield n.getChannels(b);if(!e)return console.error("Empty response received"),void S((e=>x(T({},e),{channels:[]})));if("object"!=typeof e)return void console.error("Invalid response format:",e);if("error"in e)return void console.error("API Error:",e.error);if(!Array.isArray(e.values))return void console.error("Invalid channels format:",e);const t=Object.keys(e.values[0]||{}).filter((e=>"datetime"!==e)).map((e=>({label:e,value:e})));S((e=>x(T({},e),{channels:t})))}catch(e){console.error("Error fetching channels:",e),S((e=>x(T({},e),{channels:[]})))}E(!1)}}))).apply(this,arguments)}b&&function(){e.apply(this,arguments)}()}),[n,b]),(0,g.useEffect)((()=>{if(i||a){const e=I.map((e=>({label:e.visible_name,value:e.name}))),t=D.map((e=>({label:e.visible_name,value:e.name})));S((r=>x(T({},r),{properties:e,filterProperties:t})))}}),[i,a]);const C=function(){var e=k((function*(e){try{const t=yield n.getSensors();if(t&&Array.isArray(t.sensors)){const r=t.sensors.find((t=>t.sensor===e));if(r)return h(r.objid.toString()),r.objid.toString();console.error("Sensor not found:",e)}else console.error("Invalid response format:",t)}catch(e){console.error("Error fetching sensors:",e)}return""}));return function(t){return e.apply(this,arguments)}}(),F=function(){var n=k((function*(n){const o=yield C(n.value);t(x(T({},e),{sensor:n.value,objid:o,channel:""})),d(n.value),h(o),y(""),S((e=>x(T({},e),{channels:[]}))),r()}));return function(e){return n.apply(this,arguments)}}(),W=n=>{t(x(T({},e),{property:n.value})),r()},_=n=>{t(x(T({},e),{filterProperty:n.value})),r()};return m().createElement(O.Stack,{direction:"column",gap:2},m().createElement(O.Stack,{direction:"row",gap:2},m().createElement(O.Stack,{direction:"column",gap:1},m().createElement(O.InlineField,{label:"Query Type",labelWidth:20,grow:!0},m().createElement(O.Select,{options:P,value:e.queryType,onChange:n=>{t(x(T({},e),{queryType:n.value})),r()},width:47})),m().createElement(O.InlineField,{label:"Group",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:w,options:v.groups,value:e.group,onChange:r=>{t(x(T({},e),{group:r.value,device:"",sensor:"",channel:"",objid:""})),c(r.value),u(""),d(""),y(""),h(""),S((e=>x(T({},e),{devices:[],sensors:[],channels:[]})))},width:47,allowCustomValue:!0,isClearable:!0,isDisabled:!e.queryType,placeholder:"Select Group or type '*'"})),m().createElement(O.InlineField,{label:"Device",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!v.devices.length,options:v.devices,value:e.device,onChange:r=>{t(x(T({},e),{device:r.value,sensor:"",channel:""})),u(r.value),d(""),y(""),S((e=>x(T({},e),{sensors:[],channels:[]})))},width:47,allowCustomValue:!0,placeholder:"Select Device or type '*'",isClearable:!0,isDisabled:!e.group}))),m().createElement(O.Stack,{direction:"column",gap:2},m().createElement(O.InlineField,{label:"Sensor",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!v.sensors.length,options:v.sensors,value:e.sensor,onChange:F,width:47,allowCustomValue:!0,placeholder:"Select Sensor or type '*'",isClearable:!0,isDisabled:!e.device})),o&&m().createElement(O.InlineField,{label:"Channel",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!v.channels.length,options:v.channels,value:e.channel,onChange:n=>{t(x(T({},e),{channel:n.value})),y(n.value),r()},width:47,allowCustomValue:!0,placeholder:"Select Channel or type '*'",isClearable:!0,isDisabled:!e.sensor})))),m().createElement(O.Stack,{direction:"column",gap:1},o&&m().createElement(O.FieldSet,{label:"Options"},m().createElement(O.Stack,{direction:"row",gap:1},m().createElement(O.InlineField,{label:"Include Group",labelWidth:16},m().createElement(O.InlineSwitch,{value:e.includeGroupName||!1,onChange:n=>{t(x(T({},e),{includeGroupName:n.currentTarget.checked})),r()}})),m().createElement(O.InlineField,{label:"Include Device",labelWidth:15},m().createElement(O.InlineSwitch,{value:e.includeDeviceName||!1,onChange:n=>{t(x(T({},e),{includeDeviceName:n.currentTarget.checked})),r()}})),m().createElement(O.InlineField,{label:"Include Sensor",labelWidth:15},m().createElement(O.InlineSwitch,{value:e.includeSensorName||!1,onChange:n=>{t(x(T({},e),{includeSensorName:n.currentTarget.checked})),r()}})))),i&&m().createElement(O.FieldSet,{label:"Options"},m().createElement(O.Stack,{direction:"row",gap:1},m().createElement(O.InlineField,{label:"Property",labelWidth:16},m().createElement(O.Select,{options:v.properties,value:e.property,onChange:W,width:32})),m().createElement(O.InlineField,{label:"Filter Property",labelWidth:16},m().createElement(O.Select,{options:v.filterProperties,value:e.filterProperty,onChange:_,width:32})))),a&&m().createElement(O.FieldSet,{label:"Options"},m().createElement(O.Stack,{direction:"row",gap:1},m().createElement(O.InlineField,{label:"Property",labelWidth:16},m().createElement(O.Select,{options:v.properties,value:e.property,onChange:W,width:32})),m().createElement(O.InlineField,{label:"Filter Property",labelWidth:16},m().createElement(O.Select,{options:v.filterProperties,value:e.filterProperty,onChange:_,width:32}))))))}));return c})()));
//# sourceMappingURL=module.js.map