/* [create-plugin] version: 5.15.1 */
define(["@grafana/data","@grafana/runtime","@grafana/ui","module","react"],((e,r,t,n,o)=>(()=>{"use strict";var i={781:r=>{r.exports=e},531:e=>{e.exports=r},7:e=>{e.exports=t},308:e=>{e.exports=n},959:e=>{e.exports=o}},a={};function l(e){var r=a[e];if(void 0!==r)return r.exports;var t=a[e]={exports:{}};return i[e](t,t.exports,l),t.exports}l.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return l.d(r,{a:r}),r},l.d=(e,r)=>{for(var t in r)l.o(r,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},l.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="public/plugins/maxmarkusprogram-prtg-datasource/";var c={};l.r(c),l.d(c,{plugin:()=>x});var s=l(308),u=l.n(s);l.p=u()&&u().uri?u().uri.slice(0,u().uri.lastIndexOf("/")+1):"public/plugins/maxmarkusprogram-prtg-datasource/";var p=l(781),d=l(531);function f(e,r,t,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void t(e)}l.done?r(c):Promise.resolve(c).then(n,o)}function y(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var i=e.apply(r,t);function a(e){f(i,n,o,a,l,"next",e)}function l(e){f(i,n,o,a,l,"throw",e)}a(void 0)}))}}function v(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function h(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})),e}class g extends d.DataSourceWithBackend{applyTemplateVariables(e,r){return h(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),n.forEach((function(r){v(e,r,t[r])}))}return e}({},e),{channel:(0,d.getTemplateSrv)().replace(e.channel,r)})}filterQuery(e){return!!e.channel}getGroups(){var e=this;return y((function*(){return e.getResource("groups")}))()}getDevices(e){var r=this;return y((function*(){if(!e)throw new Error("group is required");return r.getResource(`devices/${encodeURIComponent(e)}`)}))()}getSensors(e){var r=this;return y((function*(){if(!e)throw new Error("device is required");return r.getResource(`sensors/${encodeURIComponent(e)}`)}))()}getChannels(e){var r=this;return y((function*(){if(!e)throw new Error("objid is required");return r.getResource(`channels/${e}`)}))()}constructor(e){super(e),v(this,"annotations",void 0)}}var b=l(959),m=l.n(b),O=l(7);function w(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function S(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),n.forEach((function(r){w(e,r,t[r])}))}return e}function E(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})),e}var j=function(e){return e.Metrics="metrics",e.Raw="raw",e.Text="text",e.Selbts="selbts",e}({});const P=Object.keys(j).map((e=>({label:e,value:j[e]}))),I=[{name:"active",visible_name:"Active"},{name:"message_raw",visible_name:"Message"},{name:"priority",visible_name:"Priority"},{name:"status",visible_name:"Status"},{name:"tags",visible_name:"Tags"}],D=[{name:"group",visible_name:"Group"},{name:"device",visible_name:"Device"},{name:"sensor",visible_name:"Sensor"}];function C(e,r,t,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void t(e)}l.done?r(c):Promise.resolve(c).then(n,o)}function k(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var i=e.apply(r,t);function a(e){C(i,n,o,a,l,"next",e)}function l(e){C(i,n,o,a,l,"throw",e)}a(void 0)}))}}function A(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function F(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),n.forEach((function(r){A(e,r,t[r])}))}return e}function T(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})),e}const x=new p.DataSourcePlugin(g).setConfigEditor((function(e){const{onOptionsChange:r,options:t}=e,{jsonData:n,secureJsonFields:o,secureJsonData:i}=t;return m().createElement(m().Fragment,null,m().createElement(O.InlineField,{label:"Path",labelWidth:14,interactive:!0,tooltip:"Json field returned to frontend"},m().createElement(O.Input,{id:"config-editor-path",onChange:e=>{r(E(S({},t),{jsonData:E(S({},n),{path:e.target.value})}))},value:n.path,placeholder:"Enter the path, <your.prtg.server> without https://",width:60})),m().createElement(O.InlineField,{label:"API Key",labelWidth:14,interactive:!0,tooltip:"Secure json field (backend only)"},m().createElement(O.SecretInput,{required:!0,id:"config-editor-api-key",isConfigured:o.apiKey,value:null==i?void 0:i.apiKey,placeholder:"Enter your API key",width:60,onReset:()=>{r(E(S({},t),{secureJsonFields:E(S({},t.secureJsonFields),{apiKey:!1}),secureJsonData:E(S({},t.secureJsonData),{apiKey:""})}))},onChange:e=>{r(E(S({},t),{secureJsonData:{apiKey:e.target.value}}))}})),m().createElement(O.InlineField,{label:"Cache Time",labelWidth:14,interactive:!0,tooltip:"Cache time in seconds"},m().createElement(O.Input,{id:"config-editor-cache-time",onChange:e=>{r(E(S({},t),{jsonData:E(S({},n),{cacheTime:parseInt(e.target.value,10)})}))},value:n.cacheTime,placeholder:"Enter the cache time",width:60})))})).setQueryEditor((function({query:e,onChange:r,onRunQuery:t,datasource:n}){const o=e.queryType===j.Metrics,i=e.queryType===j.Raw,a=e.queryType===j.Text,[l,c]=(0,b.useState)(""),[s,u]=(0,b.useState)(""),[p,d]=(0,b.useState)(""),[f,y]=(0,b.useState)([]),[v,h]=(0,b.useState)(""),[g,w]=(0,b.useState)({groups:[],devices:[],sensors:[],channels:[],values:[],properties:[],filterProperties:[]}),[S,E]=(0,b.useState)(!1),[C,A]=(0,b.useState)(""),[x,_]=(0,b.useState)("");(0,b.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getGroups();if(e&&Array.isArray(e.groups)){const r=e.groups.map((e=>({label:e.group,value:e.group.toString()})));w((e=>T(F({},e),{groups:r})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching groups:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]),(0,b.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getDevices(l);if(e&&Array.isArray(e.devices)){const r=l?e.devices.filter((e=>e.group===l)):e.devices,t=r.map((e=>({label:e.device,value:e.device.toString()})));w((e=>T(F({},e),{devices:t})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching devices:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,l]),(0,b.useEffect)((()=>{function e(){return e=k((function*(){E(!0);try{const e=yield n.getSensors(s);if(e&&Array.isArray(e.sensors)){const r=s?e.sensors.filter((e=>e.device===s)):e.sensors,t=r.map((e=>({label:e.sensor,value:e.sensor.toString()})));w((e=>T(F({},e),{sensors:t})))}else console.error("Invalid response format:",e)}catch(e){console.error("Error fetching sensors:",e)}E(!1)})),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,s]),(0,b.useEffect)((()=>{function e(){return(e=k((function*(){if(v){E(!0);try{const e=yield n.getChannels(v);if(!e)return console.error("Empty response received"),void w((e=>T(F({},e),{channels:[]})));if("object"!=typeof e)return void console.error("Invalid response format:",e);if("error"in e)return void console.error("API Error:",e.error);if(!Array.isArray(e.values))return void console.error("Invalid channels format:",e);const r=Object.keys(e.values[0]||{}).filter((e=>"datetime"!==e)).map((e=>({label:e,value:e})));w((e=>T(F({},e),{channels:r})))}catch(e){console.error("Error fetching channels:",e),w((e=>T(F({},e),{channels:[]})))}E(!1)}}))).apply(this,arguments)}v&&function(){e.apply(this,arguments)}()}),[n,v]),(0,b.useEffect)((()=>{if(a||i){const e=D.map((e=>({label:e.visible_name,value:e.name}))),r=I.map((e=>({label:e.visible_name,value:e.name})));w((t=>T(F({},t),{properties:e,filterProperties:r})))}}),[a,i]);const W=function(){var e=k((function*(e){try{const r=yield n.getGroups();if(r&&Array.isArray(r.groups)){const t=r.groups.find((r=>r.group===e));if(t)return t.objid.toString()}}catch(e){console.error("Error finding group ID:",e)}return""}));return function(r){return e.apply(this,arguments)}}(),q=function(){var e=k((function*(e){try{const r=yield n.getDevices(l);if(r&&Array.isArray(r.devices)){const t=r.devices.find((r=>r.device===e));if(t)return t.objid.toString()}}catch(e){console.error("Error finding device ID:",e)}return""}));return function(r){return e.apply(this,arguments)}}(),R=function(){var n=k((function*(n){const o=yield W(n.value);r(T(F({},e),{group:n.value,groupId:o,device:"",deviceId:"",sensor:"",sensorId:"",channel:""})),c(n.value),A(o),u(""),_(""),d(""),h(""),y([]),w((e=>T(F({},e),{devices:[],sensors:[],channels:[]}))),t()}));return function(e){return n.apply(this,arguments)}}(),G=function(){var n=k((function*(n){const o=yield q(n.value);r(T(F({},e),{device:n.value,deviceId:o,sensor:"",sensorId:"",channel:""})),u(n.value),_(o),d(""),h(""),y([]),w((e=>T(F({},e),{sensors:[],channels:[]}))),t()}));return function(e){return n.apply(this,arguments)}}(),J=function(){var e=k((function*(e){try{const r=yield n.getSensors(s);if(r&&Array.isArray(r.sensors)){const t=r.sensors.find((r=>r.sensor===e));if(t)return h(t.objid.toString()),t.objid.toString();console.error("Sensor not found:",e)}else console.error("Invalid response format:",r)}catch(e){console.error("Error fetching sensors:",e)}return""}));return function(r){return e.apply(this,arguments)}}(),M=function(){var n=k((function*(n){const i=yield J(n.value);o?(r(T(F({},e),{sensor:n.value,sensorId:i,channel:""})),y([])):r(T(F({},e),{sensor:n.value,sensorId:i})),d(n.value),h(i),o&&w((e=>T(F({},e),{channels:[]}))),t()}));return function(e){return n.apply(this,arguments)}}();return m().createElement(O.Stack,{direction:"column",gap:2},m().createElement(O.Stack,{direction:"row",gap:2},m().createElement(O.Stack,{direction:"column",gap:1},m().createElement(O.InlineField,{label:"Query Type",labelWidth:20,grow:!0},m().createElement(O.Select,{options:P,value:e.queryType,onChange:n=>{r(T(F({},e),{queryType:n.value})),t()},width:47})),m().createElement(O.InlineField,{label:"Group",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:S,options:g.groups,value:e.group,onChange:R,width:47,allowCustomValue:!0,isClearable:!0,isDisabled:!e.queryType,placeholder:"Select Group or type '*'"})),m().createElement(O.InlineField,{label:"Device",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!g.devices.length,options:g.devices,value:e.device,onChange:G,width:47,allowCustomValue:!0,placeholder:"Select Device or type '*'",isClearable:!0,isDisabled:!e.group}))),m().createElement(O.Stack,{direction:"column",gap:2},m().createElement(O.InlineField,{label:"Sensor",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!g.sensors.length,options:g.sensors,value:e.sensor,onChange:M,width:47,allowCustomValue:!0,placeholder:"Select Sensor or type '*'",isClearable:!0,isDisabled:!e.device})),m().createElement(O.InlineField,{label:"Channel",labelWidth:20,grow:!0},m().createElement(O.Select,{isLoading:!g.channels.length,options:g.channels,value:(e.channels||[]).map((e=>({label:e,value:e})))||[],onChange:n=>{const o=Array.isArray(n)?n.map((e=>e.value||"")):[];r(T(F({},e),{channels:o,channel:o[0]||""})),y(o),t()},width:47,allowCustomValue:!0,placeholder:"Select Channel",isClearable:!0,isMulti:!0,isDisabled:!e.sensor})))),o&&m().createElement(O.FieldSet,{label:"Options"},m().createElement(O.Stack,{direction:"row",gap:1},m().createElement(O.InlineField,{label:"Include Group",labelWidth:16},m().createElement(O.InlineSwitch,{value:e.includeGroupName||!1,onChange:n=>{r(T(F({},e),{includeGroupName:n.currentTarget.checked})),t()}})),m().createElement(O.InlineField,{label:"Include Device",labelWidth:15},m().createElement(O.InlineSwitch,{value:e.includeDeviceName||!1,onChange:n=>{r(T(F({},e),{includeDeviceName:n.currentTarget.checked})),t()}})),m().createElement(O.InlineField,{label:"Include Sensor",labelWidth:15},m().createElement(O.InlineSwitch,{value:e.includeSensorName||!1,onChange:n=>{r(T(F({},e),{includeSensorName:n.currentTarget.checked})),t()}})))),(a||i)&&m().createElement(O.FieldSet,{label:"Options"},m().createElement(O.Stack,{direction:"row",gap:1},m().createElement(O.InlineField,{label:"Property",labelWidth:16},m().createElement(O.Select,{options:g.properties,value:e.property,onChange:n=>{r(T(F({},e),{property:n.value})),t()},width:32})),m().createElement(O.InlineField,{label:"Filter Property",labelWidth:16},m().createElement(O.Select,{options:g.filterProperties,value:e.filterProperty,onChange:n=>{r(T(F({},e),{filterProperty:n.value})),t()},width:32})))))}));return c})()));
//# sourceMappingURL=module.js.map